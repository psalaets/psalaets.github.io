<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="description" content="Controlling friction and bounce of bodies in the p2 physics engine"><link rel="stylesheet" href="/1.3.0/main.css"><link rel="canonical" href="https://paulsalaets.com/"><title>Friction and bounce in p2.js | paulsalaets.com</title></head><body class="font-base font-sans text-gray-900"><header class="p-4 sm:p-8"><a href="#main" class="skipnav">skip to main content</a><nav><a class="font-bold text-sm sm:text-base inline-block mr-4" href="/" title="Home">Paul Salaets </a><a class="text-sm sm:text-base inline-block mr-4" href="/" title="Home">Home </a><a class="text-sm sm:text-base inline-block mr-4" href="/about" title="About">About </a><a class="text-sm sm:text-base inline-block mr-4" href="/archive" title="Archive">Archive</a></nav></header><main id="main" class="pb-4"><div class="mx-auto bg-white p-4 sm:max-w-3xl sm:px-16"><article><header class="mb-8"><h1 class="text-3xl font-bold">Friction and bounce in p2.js</h1><span class="text-sm">10 Feb 2015</span></header><section class="post-content"><p>p2 is a JavaScript 2D physics library that works in the browser and node. Setting an object's friction and bounce is not obvious at first glance.</p><h3>Versions used below</h3><pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token string">"p2"</span><span class="token keyword">:</span> <span class="token string">"0.6.0"</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><h2>Body doesn't have friction and bounce</h2><p><a href="http://schteppe.github.io/p2.js/docs/classes/Body.html">Body</a> seems like the most sensible place to have friction and bounce properties but they're not there.</p><p>p2 handles it in a more flexible way at the cost of a little more initial set up. Here's how you do it...</p><h2>Assign Materials to Shapes</h2><p>Bodies are made up of one or more Shapes and each Shape can have a <a href="http://schteppe.github.io/p2.js/docs/classes/Material.html">Material</a>. Materials have no physical properties. They act as identifiers representing whatever the Shape is made out of.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token comment">// create body</span></span><br><span class="highlight-line"><span class="token keyword">var</span> boxBody <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">p2<span class="token punctuation">.</span>Body</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><br><span class="highlight-line">  mass<span class="token punctuation">:</span> <span class="token number">1</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// add shape to body</span></span><br><span class="highlight-line"><span class="token keyword">var</span> boxShape <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">p2<span class="token punctuation">.</span>Rectangle</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">boxBody<span class="token punctuation">.</span><span class="token function">addShape</span><span class="token punctuation">(</span>boxShape<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// assign material to shape</span></span><br><span class="highlight-line"><span class="token keyword">var</span> boxMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">p2<span class="token punctuation">.</span>Material</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">boxShape<span class="token punctuation">.</span>material <span class="token operator">=</span> boxMaterial<span class="token punctuation">;</span></span></code></pre><h2>Create ContactMaterials for pairs of Materials</h2><p>A <a href="http://schteppe.github.io/p2.js/docs/classes/ContactMaterial.html">ContactMaterial</a> is a pairing of two Materials. ContactMaterials have properties that control the physics when Shapes with those Materials collide. This is where friction and bounce, among other things, can be set.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token keyword">var</span> boxVsBall <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">p2<span class="token punctuation">.</span>ContactMaterial</span><span class="token punctuation">(</span>boxMaterial<span class="token punctuation">,</span> ballMaterial<span class="token punctuation">,</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token comment">// friction</span></span><br><span class="highlight-line">    friction<span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token comment">// bounce</span></span><br><span class="highlight-line">    restitution<span class="token punctuation">:</span> <span class="token number">1</span></span><br><span class="highlight-line">    <span class="token comment">// see p2 docs for other options allowed here</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>The values to use is not an exact science. I tweak and check repeatedly until it feels right for my game. For inspiration see <a href="http://schteppe.github.io/p2.js/">p2's demos and examples</a>.</p><p>ContactMaterials must be added to the World so p2 knows about them.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line">world<span class="token punctuation">.</span><span class="token function">addContactMaterial</span><span class="token punctuation">(</span>boxVsBall<span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><h2>Default ContactMaterial</h2><p>If both colliding Shapes have a Material and the World has a ContactMaterial for that pair, it will be used. Otherwise the World's default ContactMaterial is used. The default ContactMaterial has reasonable defaults and can be modified.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line">world<span class="token punctuation">.</span>defaultContactMaterial<span class="token punctuation">.</span>friction <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span></code></pre><p>If your objects will all interact with the same physics, this is a quick way to get going.</p></section></article></div></main><footer class="p-8 text-center text-sm border-t-2 border-gray-200"><span>Â©2019 Paul Salaets</span><br><span>Built with <a href="https://www.11ty.io/" rel="noopener noreferrer" class="text-blue-700 underline">Eleventy</a> and <a href="https://tailwindcss.com/" rel="noopener noreferrer" class="text-blue-700 underline">Tailwind CSS</a></span></footer></body></html>