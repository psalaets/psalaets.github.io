<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="description" content="Using BrowserSync to update css on a page without reloading the browser."><link rel="stylesheet" href="/1.8.0/main.css"><link rel="canonical" href="https://paulsalaets.com/"><title>Injecting styles into a page with BrowserSync | paulsalaets.com</title></head><body class="font-base font-sans text-gray-900"><header class="p-4 sm:p-8"><a href="#main" class="skipnav">skip to main content</a><nav><a class="font-bold text-sm sm:text-base inline-block mr-4" href="/" title="Home">Paul Salaets </a><a class="text-sm sm:text-base inline-block mr-4" href="/" title="Home">Home </a><a class="text-sm sm:text-base inline-block mr-4" href="/about" title="About">About </a><a class="text-sm sm:text-base inline-block mr-4" href="/archive" title="Archive">Archive</a></nav></header><main id="main" class="pb-4"><div class="mx-auto bg-white p-4 sm:max-w-3xl sm:px-16"><article><header class="mb-8"><h1 class="text-3xl font-bold">Injecting styles into a page with BrowserSync</h1><span class="text-sm">17 May 2015</span></header><section class="post-content"><p>Every time I open the BrowserSync docs I find something awesome.</p><h3>Versions used below</h3><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token string">"browser-sync"</span><span class="token punctuation">:</span> <span class="token string">"2.7.1"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token string">"gulp"</span><span class="token punctuation">:</span> <span class="token string">"3.8.11"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token string">"gulp-sass"</span><span class="token punctuation">:</span> <span class="token string">"2.0.0"</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><h2>BrowserSync</h2><p><a href="http://www.browsersync.io/">BrowserSync</a> is a great module that I use for a static web server with auto-reload. It does a lot more than auto-reload but that's my main use for it.</p><p>When paired with Gulp, BrowserSync can inject css into a page -- <em>no page reload needed</em>.</p><h2>Basic Setup</h2><p>Given this project structure</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token keyword">.</span></span><br><span class="highlight-line">├── app/</span><br><span class="highlight-line">│   ├── index.html</span><br><span class="highlight-line">│   └── css/</span><br><span class="highlight-line">│       └── app.css</span><br><span class="highlight-line">├── gulpfile.js</span><br><span class="highlight-line">└── package.json</span></code></pre><p>Here is a simple gulp build that uses BrowserSync to serve static files and reload browsers when css or html changes.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token comment">// create new instance of BrowserSync</span></span><br><span class="highlight-line"><span class="token keyword">var</span> browserSync <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'browser-sync'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'watch'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">gulpCallback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  browserSync<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token comment">// serve out of app/</span></span><br><span class="highlight-line">    server<span class="token punctuation">:</span> <span class="token string">'./app/'</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token comment">// launch default browser as soon as server is up</span></span><br><span class="highlight-line">    open<span class="token punctuation">:</span> <span class="token boolean">true</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token comment">// (server is now up)</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token comment">// set up watch to reload browsers when source changes</span></span><br><span class="highlight-line">    gulp<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'app/index.html'</span><span class="token punctuation">,</span> <span class="token string">'app/css/*'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> browserSync<span class="token punctuation">.</span>reload<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token comment">// notify gulp that this task is done</span></span><br><span class="highlight-line">    <span class="token function">gulpCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>This is nice but the browser reloads the entire page when the css changes.</p><p>BrowserSync can do better.</p><h2>Injecting Styles into the Page</h2><p>With a small change to the watches it will push css updates without a page reload.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token comment">// create new instance of BrowserSync</span></span><br><span class="highlight-line"><span class="token keyword">var</span> browserSync <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'browser-sync'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'watch'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">gulpCallback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  browserSync<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token comment">// serve out of app/</span></span><br><span class="highlight-line">    server<span class="token punctuation">:</span> <span class="token string">'./app/'</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token comment">// launch default browser as soon as server is up</span></span><br><span class="highlight-line">    open<span class="token punctuation">:</span> <span class="token boolean">true</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token comment">// (server is now up)</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token comment">// watch html and reload browsers when it changes</span></span><br><span class="highlight-line">    gulp<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'app/index.html'</span><span class="token punctuation">,</span> browserSync<span class="token punctuation">.</span>reload<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token comment">// watch css and stream to BrowserSync when it changes</span></span><br><span class="highlight-line">    gulp<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'app/css/*'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      <span class="token comment">// grab css files and send them into browserSync.stream</span></span><br><span class="highlight-line">      <span class="token operator">/</span><span class="token operator">/</span> <span class="token keyword">this</span> injects the css into the page</span><br><span class="highlight-line">      gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'app/css/*'</span><span class="token punctuation">)</span></span><br><span class="highlight-line">        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>browserSync<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token comment">// notify gulp that this task is done</span></span><br><span class="highlight-line">    <span class="token function">gulpCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>This is a very simple example but you can move the call to <code>browserSync.stream()</code> elsewhere in more complex builds. As long as css files are going in, it should work.</p><h2>Using a CSS Preprocessor</h2><p>We'll use Sass to generate css. Now the project looks like</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token keyword">.</span></span><br><span class="highlight-line">├── app/</span><br><span class="highlight-line">│   ├── css/</span><br><span class="highlight-line">│   │   └── app.css  <span class="token punctuation">(</span>index.html references this<span class="token punctuation">)</span></span><br><span class="highlight-line">│   ├── index.html</span><br><span class="highlight-line">│   └── scss/</span><br><span class="highlight-line">│       └── app.scss <span class="token punctuation">(</span>edit this to change styles<span class="token punctuation">)</span></span><br><span class="highlight-line">├── gulpfile.js</span><br><span class="highlight-line">└── package.json</span></code></pre><p>Bringing in a CSS preprocessor requires another small change to the build.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">var</span> sass <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-sass'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token comment">// create new instance of BrowserSync</span></span><br><span class="highlight-line"><span class="token keyword">var</span> browserSync <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'browser-sync'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'watch'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'build-styles'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">gulpCallback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  browserSync<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token comment">// serve out of app/</span></span><br><span class="highlight-line">    server<span class="token punctuation">:</span> <span class="token string">'./app/'</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    <span class="token comment">// launch default browser as soon as server is up</span></span><br><span class="highlight-line">    open<span class="token punctuation">:</span> <span class="token boolean">true</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token comment">// (server is now up)</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token comment">// watch html and reload browsers when it changes</span></span><br><span class="highlight-line">    gulp<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'app/index.html'</span><span class="token punctuation">,</span> browserSync<span class="token punctuation">.</span>reload<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token comment">// when sass files change run specified gulp task</span></span><br><span class="highlight-line">    gulp<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'app/scss/*'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'build-styles'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token comment">// notify gulp that this task is done</span></span><br><span class="highlight-line">    <span class="token function">gulpCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token operator">/</span><span class="token operator">/</span> run sass then stream resulting css to output dir and to BrowserSync</span><br><span class="highlight-line">gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'build-styles'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'app/scss/*'</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">sass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'app/css'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token comment">// if BrowserSync's static server isn't running this stream is a no-op passthrough</span></span><br><span class="highlight-line">    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>browserSync<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>You could do something similar for Less and Stylus.</p><p>Injecting css like this is nice because it's faster and parts of the UI that depend on JavaScript aren't reset.</p></section></article></div></main><footer class="p-8 text-center text-sm border-t-2 border-gray-200"><span>©2019 Paul Salaets</span><br><span>Built with <a href="https://www.11ty.io/" rel="noopener noreferrer" class="text-blue-700 underline">Eleventy</a> and <a href="https://tailwindcss.com/" rel="noopener noreferrer" class="text-blue-700 underline">Tailwind CSS</a></span></footer></body></html>