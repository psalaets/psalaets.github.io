<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="description" content="How to get Angular dependencies injected into arbitrary functions"><link rel="stylesheet" href="/1.11.0/main.css"><link rel="canonical" href="https://paulsalaets.com/"><title>Injecting Angular services into your own code | paulsalaets.com</title></head><body class="font-base font-sans text-gray-900"><header class="p-4 sm:p-8"><a href="#main" class="skipnav">skip to main content</a><nav><a class="font-bold text-sm sm:text-base inline-block mr-4" href="/" title="Home">Paul Salaets </a><a class="text-sm sm:text-base inline-block mr-4" href="/" title="Home">Home </a><a class="text-sm sm:text-base inline-block mr-4" href="/about" title="About">About </a><a class="text-sm sm:text-base inline-block mr-4" href="/archive" title="Archive">Archive</a></nav></header><main id="main" class="pb-4"><div class="mx-auto bg-white p-4 sm:max-w-3xl sm:px-16"><article><header class="mb-8"><h1 class="text-3xl font-bold">Injecting Angular services into your own code</h1><span class="text-sm">30 Mar 2015</span></header><section class="post-content"><p>Define and run an arbitrary function that can have Angular services injected into it.</p><p><strong>Versions used below</strong></p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token string">"angular"</span><span class="token punctuation">:</span> <span class="token string">"1.3.14"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token string">"ng-annotate"</span><span class="token punctuation">:</span> <span class="token string">"0.15.4"</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><h2>Why not just use closures?</h2><p>The easy solution is using a closure to access dependencies instead of injecting them as parameters.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line">app<span class="token punctuation">.</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token string">'myService'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">service1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  <span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token comment">// service1 is available here</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>In my case, the function was created in a module config block and passed to a provider to be invoked later. You can only inject providers and Angular constants into config blocks so the closure trick won't work.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token comment">// DOES NOT WORK</span></span><br><span class="highlight-line">app<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">service1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// services don't exist during config phase so can't inject here</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  <span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>The above results in error:</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line">Error: <span class="token punctuation">[</span><span class="token variable">$injector</span>:modulerr<span class="token punctuation">]</span> Failed to instantiate module app due to:</span><br><span class="highlight-line"><span class="token punctuation">[</span><span class="token variable">$injector</span>:unpr<span class="token punctuation">]</span> Unknown provider: service1</span></code></pre><h2>Using $injector</h2><p>Angular makes this pretty easy. Use <a href="https://code.angularjs.org/1.3.14/docs/api/auto/service/$injector">$injector</a> to invoke the function.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line">$injector<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p><code>$injector.invoke</code> invokes <code>func</code> with all its dependencies as parameters and returns <code>func</code>'s return value.</p><p><code>func</code> must follow one of the three Angular &quot;injectable function&quot; patterns:</p><h3>1. inferred</h3><p>Note: this style won't work if the code is minified</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token parameter">dep1<span class="token punctuation">,</span> dep2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><h3>2. inline</h3><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token punctuation">[</span><span class="token string">'dep1'</span><span class="token punctuation">,</span> <span class="token string">'dep2'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token parameter">dep1<span class="token punctuation">,</span> dep2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">]</span></span></code></pre><h3>3. annotated</h3><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token parameter">dep1<span class="token punctuation">,</span> dep2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token punctuation">}</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">func<span class="token punctuation">.</span>$inject <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'dep1'</span><span class="token punctuation">,</span> <span class="token string">'dep2'</span><span class="token punctuation">]</span></span></code></pre><h2>ng-annotate compatibility</h2><p>This injection can happen anywhere. It's not in the Angular API like all other injections we're used to. Will <a href="https://github.com/olov/ng-annotate">ng-annotate</a> still see it?</p><p>The answer is... maybe.</p><p>There is only so much ng-annotate can detect through static code analysis. It has options for <a href="https://github.com/olov/ng-annotate#explicit-annotations-with-nginject">explicitly marking code to be annotated</a> but at that point you might as well just annotate the code yourself.</p></section></article></div></main><footer class="p-8 text-center text-sm border-t-2 border-gray-200"><span>Â©2019 Paul Salaets</span><br><span>Built with <a href="https://www.11ty.io/" rel="noopener noreferrer" class="text-blue-700 underline">Eleventy</a> and <a href="https://tailwindcss.com/" rel="noopener noreferrer" class="text-blue-700 underline">Tailwind CSS</a></span></footer></body></html>