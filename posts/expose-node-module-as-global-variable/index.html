<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="description" content="Use browserify or webpack to make a CommonJS-only module available as a global variable"><style>.nofouc{display:none;}</style><script>document.documentElement.className='nofouc';</script><link rel="stylesheet" href="/styles/1.39.0/index.css"><script>document.documentElement.className='';</script><link rel="canonical" href="https://paulsalaets.com/"><link rel="alternate" type="application/rss+xml" title="Subscribe to posts" href="/feed.xml"><title>Exposing a node module as a global variable | paulsalaets.com</title></head><body class="text-base font-sans text-gray-900"><header class="p-4 mx-auto sm:max-w-3xl sm:px-20"><a href="#main" class="skipnav">skip to main content</a><nav><div class="w-full text-center mb-2 md:mb-0 md:inline-block md:w-auto md:text-left"><a class="font-bold inline-block mr-3" href="/" title="Home">Paul Salaets</a></div><div class="w-full text-center md:inline-block md:w-auto md:text-left"><a class="px-3 py-2" href="/" title="Home"><span class="inline-block border-b-4 border-white">Home</span> </a><a class="px-3 py-2" href="/about/" title="About"><span class="inline-block border-b-4 border-white">About</span> </a><a class="px-3 py-2" href="/archive/" title="Archive"><span class="inline-block border-b-4 border-white">Archive</span> </a><a class="px-3 py-2" href="/feed.xml" title="Feed"><span class="sr-only">RSS Feed</span> <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="rss" class="svg-inline--fa fa-rss fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"></path></svg></a></div></nav></header><main id="main" class="pb-4"><div class="mx-auto bg-white p-4 sm:max-w-3xl sm:px-20"><article><header class="mb-8"><h1 class="text-3xl font-bold">Exposing a node module as a global variable</h1><span class="text-sm">1 Jun 2015</span></header><section class="post-content"><p>I wanted to try a node module in a browser app that uses global variables to share stuff.</p><p><strong>Versions used below</strong></p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token string">"superagent"</span><span class="token punctuation">:</span> <span class="token string">"1.2.0"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token string">"browserify"</span><span class="token punctuation">:</span> <span class="token string">"10.2.3"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token string">"webpack"</span><span class="token punctuation">:</span> <span class="token string">"1.9.10"</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>I was thinking about using <a href="https://github.com/visionmedia/superagent" rel="noopener">superagent</a> to do ajax in a browser app that uses globals to access libraries and modules. The slightly opinionated superagent only supports CommonJS.</p><p>Two module bundlers that can make a CommonJS-only module available as a global are <a href="https://github.com/substack/node-browserify" rel="noopener">browserify</a> and <a href="https://github.com/webpack/webpack" rel="noopener">webpack</a>.</p><h2>1. Install the node module</h2><p>Create a package.json if there isn't one already. This will be your record of what version of the module was used.</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line">$ <span class="token function">npm</span> init -f</span></code></pre><p><code>-f</code> will <a href="/posts/quickly-accepting-defaults-of-npm-init-and-bower-init/" rel="noopener">accept all the default options</a> of npm init.</p><p>Then install the module.</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line">$ <span class="token function">npm</span> <span class="token function">install</span> superagent -S</span></code></pre><h2>2. Create entry file</h2><p>browserify and webpack will bundle dependencies of the entry file (and their dependencies, and dependencies of their dependencies, etc). In this case a dependency is anything pulled in through a <code>require()</code> call.</p><p>The entry file is just a CommonJS passthrough -- it exports the module we want to use.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token comment">// entry.js</span></span><br><span class="highlight-line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'superagent'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><h2>3a. Use browserify</h2><p>browserify's <code>--standalone</code> option uses <a href="https://github.com/ForbesLindesay/umd" rel="noopener">umd</a> to make the resulting bundle work with most JavaScript module systems. A global variable is created if no module system is detected.</p><p>The argument to <code>--standalone</code> is the name of the global variable. It's named <code>request</code> below because that's the naming convention used in the <a href="http://visionmedia.github.io/superagent/" rel="noopener">superagent docs</a>.</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line">$ browserify entry.js --standalone request --outfile superagent-global.js</span></code></pre><h2>3b. Or use webpack</h2><p>The command I use for webpack is similar to browserify.</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line">$ webpack entry.js --output-library request --outfile superagent-global.js</span></code></pre><p>It will default to creating a global variable named by the argument to <code>--output-library</code>. To generate a umd module or any other type, you'd also use <code>--output-library-target</code> and <a href="http://webpack.github.io/docs/configuration.html#output-librarytarget" rel="noopener">specify the module type</a>.</p><h2>Final usage</h2><p>Now in my browser app I can do</p><pre class="language-html"><code class="language-html"><span class="highlight-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>superagent-global.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br><span class="highlight-line">  request<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/foo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre></section></article></div></main><footer class="p-8 text-center text-sm border-t-2 border-gray-200"><span>Â©2020 Paul Salaets</span><br><span>Built with <a href="https://www.11ty.io/" rel="noopener" class="text-blue-700 underline">Eleventy</a> and <a href="https://tailwindcss.com/" rel="noopener" class="text-blue-700 underline">Tailwind CSS</a></span></footer></body></html>