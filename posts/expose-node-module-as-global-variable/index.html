<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="description" content="Personal site of Paul Salaets">
  <link rel="stylesheet" href="/1.0.0/main.css">
  <link rel="canonical" href="https://paulsalaets.com/">
  <title>
    Exposing a node module as a global variable | paulsalaets.com
  </title>
</head>
<body class="font-base font-sans text-gray-900">
  <header class="p-4 sm:p-8">
    <nav>
  <a class="font-bold text-sm sm:text-base inline-block mr-4" href="/" title="Home">
    Paul Salaets
  </a>
  <a class="text-sm sm:text-base inline-block mr-4 " href="/" title="Home">
    Home
  </a>
  <a class="text-sm sm:text-base inline-block mr-4 " href="/about" title="About">
    About
  </a>
  <a class="text-sm sm:text-base inline-block mr-4 " href="/archive" title="Archive">
    Archive
  </a>
</nav>

  </header>
  <main class="pb-4">
    <div class="mx-auto bg-white p-4 sm:max-w-3xl sm:px-16">
      <article>
  <header class="mb-8">
    <h1 class="text-3xl font-bold">Exposing a node module as a global variable</h1>
    <span class="text-sm">1 Jun 2015</span>
  </header>
  <section class="post-content">
    <p>I wanted to try a node module in a browser app that uses global variables to share stuff.</p>
<h3>Versions used below</h3>
<pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token string">"superagent"</span><span class="token punctuation">:</span> <span class="token string">"1.2.0"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token string">"browserify"</span><span class="token punctuation">:</span> <span class="token string">"10.2.3"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token string">"webpack"</span><span class="token punctuation">:</span> <span class="token string">"1.9.10"</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>I was thinking about using <a href="https://github.com/visionmedia/superagent">superagent</a> to do ajax in a browser app that uses globals to access libraries and modules. The slightly opinionated superagent only supports CommonJS.</p>
<p>Two module bundlers that can make a CommonJS-only module available as a global are <a href="https://github.com/substack/node-browserify">browserify</a> and <a href="https://github.com/webpack/webpack">webpack</a>.</p>
<h2>1. Install the node module</h2>
<p>Create a package.json if there isn't one already. This will be your record of what version of the module was used.</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line">$ <span class="token function">npm</span> init -f</span></code></pre>
<p><code>-f</code> will <a href="/posts/quickly-accepting-defaults-of-npm-init-and-bower-init/">accept all the default options</a> of npm init.</p>
<p>Then install the module.</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line">$ <span class="token function">npm</span> <span class="token function">install</span> superagent -S</span></code></pre>
<h2>2. Create entry file</h2>
<p>browserify and webpack will bundle dependencies of the entry file (and their dependencies, and dependencies of their dependencies, etc). In this case a dependency is anything pulled in through a <code>require()</code> call.</p>
<p>The entry file is just a CommonJS passthrough -- it exports the module we want to use.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token comment">// entry.js</span></span><br><span class="highlight-line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'superagent'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>
<h2>3a. Use browserify</h2>
<p>browserify's <code>--standalone</code> option uses <a href="https://github.com/ForbesLindesay/umd">umd</a> to make the resulting bundle work with most JavaScript module systems. A global variable is created if no module system is detected.</p>
<p>The argument to <code>--standalone</code> is the name of the global variable. It's named <code>request</code> below because that's the naming convention used in the <a href="http://visionmedia.github.io/superagent/">superagent docs</a>.</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line">$ browserify entry.js --standalone request --outfile superagent-global.js</span></code></pre>
<h2>3b. Or use webpack</h2>
<p>The command I use for webpack is similar to browserify.</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line">$ webpack entry.js --output-library request --outfile superagent-global.js</span></code></pre>
<p>It will default to creating a global variable named by the argument to <code>--output-library</code>. To generate a umd module or any other type, you'd also use <code>--output-library-target</code> and <a href="http://webpack.github.io/docs/configuration.html#output-librarytarget">specify the module type</a>.</p>
<h2>Final usage</h2>
<p>Now in my browser app I can do</p>
<pre class="language-html"><code class="language-html"><span class="highlight-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>superagent-global.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br><span class="highlight-line">  request<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/foo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
  </section>
</article>

    </div>
  </main>
  <footer class="p-8 text-center text-sm border-t-2 border-gray-200">
    <span class="whitespace-no-wrap">
      Â©2019 Paul Salaets.
    </span>
    <span class="whitespace-no-wrap">
      Built with <a href="https://www.11ty.io/" rel="noopener noreferrer" class="text-blue-700 underline">Eleventy</a> and <a href="https://tailwindcss.com/" rel="noopener noreferrer" class="text-blue-700 underline">Tailwind CSS</a>.
    </span>
  </footer>
</body>
</html>
