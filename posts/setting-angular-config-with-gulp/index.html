<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="description" content="A way to set an Angular app config from a Gulp build"><link rel="stylesheet" href="/1.5.0/main.css"><link rel="canonical" href="https://paulsalaets.com/"><title>Setting Angular config with Gulp | paulsalaets.com</title></head><body class="font-base font-sans text-gray-900"><header class="p-4 sm:p-8"><a href="#main" class="skipnav">skip to main content</a><nav><a class="font-bold text-sm sm:text-base inline-block mr-4" href="/" title="Home">Paul Salaets </a><a class="text-sm sm:text-base inline-block mr-4" href="/" title="Home">Home </a><a class="text-sm sm:text-base inline-block mr-4" href="/about" title="About">About </a><a class="text-sm sm:text-base inline-block mr-4" href="/archive" title="Archive">Archive</a></nav></header><main id="main" class="pb-4"><div class="mx-auto bg-white p-4 sm:max-w-3xl sm:px-16"><article><header class="mb-8"><h1 class="text-3xl font-bold">Setting Angular config with Gulp</h1><span class="text-sm">21 Jun 2015</span></header><section class="post-content"><p>Exploring a way to set an Angular app's config from a Gulp build.</p><h3>Versions used below</h3><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token string">"angular"</span><span class="token punctuation">:</span> <span class="token string">"1.4.0"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token string">"gulp"</span><span class="token punctuation">:</span> <span class="token string">"3.9.0"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token string">"gulp-ng-config"</span><span class="token punctuation">:</span> <span class="token string">"1.2.1"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token string">"add-stream"</span><span class="token punctuation">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token string">"gulp-concat"</span><span class="token punctuation">:</span> <span class="token string">"2.4.2"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token string">"buffer-to-vinyl"</span><span class="token punctuation">:</span> <span class="token string">"1.0.0"</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><h2>What is Angular config?</h2><p>For the purposes of this post, Angular config is the <a href="https://code.angularjs.org/1.4.0/docs/api/ng/type/angular.Module#constant">constants defined on a module</a>.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line">angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span></span><br><span class="highlight-line">  <span class="token punctuation">.</span><span class="token function">constant</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'bob'</span><span class="token punctuation">)</span></span><br><span class="highlight-line">  <span class="token punctuation">.</span><span class="token function">constant</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">,</span> <span class="token string">'http://example.org'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>Apps typically use those constants in <a href="https://code.angularjs.org/1.4.0/docs/api/ng/type/angular.Module#config">config blocks</a> to <a href="/posts/disable-debug-info-to-increase-angular-performance/">turn off debug helpers</a>, set urls, toggle app flags, etc.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line">angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> someServiceProvider</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  someServiceProvider<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><h2>Using gulp-ng-config</h2><p>Given a json file, <a href="https://www.npmjs.com/package/gulp-ng-config">gulp-ng-config</a> generates JavaScript that defines constants.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token keyword">var</span> gulpNgConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-ng-config'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">function</span> <span class="token function">makeConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'./app-config.json'</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">gulpNgConfig</span><span class="token punctuation">(</span><span class="token string">'app.config'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>Assuming <code>app-config.json</code> looks like</p><pre class="language-json"><code class="language-json"><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"bob"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"http://example.org"</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p><code>gulp-ng-config</code> generates a js file that looks like</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line">angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">'app.config'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token punctuation">.</span><span class="token function">constant</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">"bob"</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token punctuation">.</span><span class="token function">constant</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">,</span> <span class="token string">"http://example.org"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><h3>Appending to app js</h3><p>Use <a href="https://www.npmjs.com/package/add-stream">add-stream</a> and <a href="https://www.npmjs.com/package/gulp-concat">gulp-concat</a> to append the generated config to your main app js.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token keyword">var</span> addStream <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'add-stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">var</span> concat <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-concat'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'js'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'./app/js/**/*'</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>addStream<span class="token punctuation">.</span><span class="token function">obj</span><span class="token punctuation">(</span><span class="token function">makeConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// makeConfig is defined a few code blocks up</span></span><br><span class="highlight-line">    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'app.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'...'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>Also be sure your app module depends on the config module.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line">angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'app.config'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><h3>Environment specific config</h3><p>The second parameter to <code>gulp-ng-config</code> is an <a href="https://github.com/ajwhite/gulp-ng-config#configuration">options object</a>.</p><p>If the <code>environment</code> option is set, <code>gulp-ng-config</code> looks for a top-level property in the json matching that name and uses its value as the config. This is an easy way to have different settings for development, test and production.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token keyword">function</span> <span class="token function">makeConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'./app-config.json'</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">gulpNgConfig</span><span class="token punctuation">(</span><span class="token string">'app.config'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">      environment<span class="token punctuation">:</span> <span class="token string">'production'</span> <span class="token comment">// or maybe use process.env.NODE_ENV here</span></span><br><span class="highlight-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p><code>app-config.json</code></p><pre class="language-json"><code class="language-json"><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token property">"production"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"http://prod.com"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token property">"development"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"http://dev.com"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><p>Result:</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line">angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">'app.config'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token punctuation">.</span><span class="token function">constant</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">,</span> <span class="token string">"http://prod.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><h3>Without a json file on disk</h3><p>If your config values come from somewhere <em>other</em> than a file on disk, you can use <a href="https://www.npmjs.com/package/buffer-to-vinyl">buffer-to-vinyl</a> to create and stream a vinyl file into <code>gulp-ng-config</code>.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token keyword">var</span> b2v <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'buffer-to-vinyl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">var</span> gulpNgConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-ng-config'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">function</span> <span class="token function">makeConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">var</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token comment">// your config here</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  <span class="token keyword">return</span> b2v<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'config.js'</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">gulpNgConfig</span><span class="token punctuation">(</span><span class="token string">'app.config'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre></section></article></div></main><footer class="p-8 text-center text-sm border-t-2 border-gray-200"><span>©2019 Paul Salaets</span><br><span>Built with <a href="https://www.11ty.io/" rel="noopener noreferrer" class="text-blue-700 underline">Eleventy</a> and <a href="https://tailwindcss.com/" rel="noopener noreferrer" class="text-blue-700 underline">Tailwind CSS</a></span></footer></body></html>