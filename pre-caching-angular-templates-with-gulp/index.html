<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="description" content="Using gulp to pre-cache Angular templates so they are included with the initial app load"><link rel="stylesheet" href="/1.15.0/main.css"><link rel="canonical" href="https://paulsalaets.com/"><title>Pre-caching Angular templates with Gulp | paulsalaets.com</title></head><body class="text-base font-sans text-gray-900"><header class="p-4 mx-auto sm:max-w-3xl sm:px-20"><a href="#main" class="skipnav">skip to main content</a><nav><a class="font-bold text-sm sm:text-base inline-block mr-3" href="/" title="Home">Paul Salaets </a><a class="px-3 py-2" href="/" title="Home"><span class="text-sm sm:text-base inline-block">Home </span></a><a class="px-3 py-2" href="/about" title="About"><span class="text-sm sm:text-base inline-block">About </span></a><a class="px-3 py-2" href="/archive" title="Archive"><span class="text-sm sm:text-base inline-block">Archive</span></a></nav></header><main id="main" class="pb-4"><div class="mx-auto bg-white p-4 sm:max-w-3xl sm:px-20"><article><header class="mb-8"><h1 class="text-3xl font-bold">Pre-caching Angular templates with Gulp</h1><span class="text-sm">4 Jan 2015</span></header><section class="post-content"><p>In production deployments, include directive and route templates as part of your initial js load to reduce http requests made when using your app.</p><p><strong>Versions used below</strong></p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token string">"angular"</span><span class="token punctuation">:</span> <span class="token string">"1.3.8"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token string">"add-stream"</span><span class="token punctuation">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token string">"gulp"</span><span class="token punctuation">:</span> <span class="token string">"3.8.10"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token string">"gulp-angular-templatecache"</span><span class="token punctuation">:</span> <span class="token string">"1.5.0"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token string">"gulp-concat"</span><span class="token punctuation">:</span> <span class="token string">"2.4.2"</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><h2>1. Get gulp-angular-templatecache</h2><p>I like using <a href="https://www.npmjs.com/package/gulp-angular-templatecache" rel="noopener">gulp-angular-templatecache</a> to generate js code that puts templates into <code>$templateCache</code>.</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line">$ <span class="token function">npm</span> <span class="token function">install</span> gulp-angular-templatecache --save-dev</span></code></pre><h2>2. Create Angular module to drop templates into</h2><p>By default <code>gulp-angular-templatecache</code> uses the Angular module <code>templates</code> to populate <code>$templateCache</code> and assumes the <code>templates</code> module is already defined. You can tweak the behavior of <code>gulp-angular-templatecache</code>. See its <a href="https://github.com/miickel/gulp-angular-templatecache#gulp-angular-templatecache" rel="noopener">README</a> for more info.</p><p>Define the module</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token comment">// Include a comment about why this seemingly unused module exists</span></span><br><span class="highlight-line">angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">'templates'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>Don't forget to depend on <code>templates</code> in your main app module.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line">angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">  <span class="token string">'templates'</span></span><br><span class="highlight-line"><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><h2>3. Run gulp-angular-templatecache in your Gulp build</h2><p>Since <code>gulpfile.js</code> is just JavaScript, I'm wrapping the template pre-caching in a function. The resulting stream will be combined with app.js in next step.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token keyword">var</span> angularTemplateCache <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-angular-templatecache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">function</span> <span class="token function">prepareTemplates</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'app/templates/**/*.html'</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token comment">//.pipe(minify and preprocess the template html here)</span></span><br><span class="highlight-line">    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">angularTemplateCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span></span></code></pre><h2>4. Append resulting js onto your app.js</h2><p>I use <a href="https://www.npmjs.com/package/add-stream" rel="noopener">add-stream</a> and <a href="https://www.npmjs.com/package/gulp-concat" rel="noopener">gulp-concat</a> to append the js generated in previous step with my app js.</p><pre class="language-javascript"><code class="language-javascript"><span class="highlight-line"><span class="token keyword">var</span> concat <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-concat'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">var</span> addStream <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'add-stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'build-app.js'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'app/scripts/**/*.js'</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token comment">//.pipe(concat your app js files somehow)</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token comment">// append the template js onto app.js</span></span><br><span class="highlight-line">    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>addStream<span class="token punctuation">.</span><span class="token function">obj</span><span class="token punctuation">(</span><span class="token function">prepareTemplates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line">    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'app.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">    <span class="token comment">//.pipe(ng annotate, minify, etc)</span></span><br><span class="highlight-line">    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'build/scripts'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><h2>5. Verify</h2><ul><li>Look at resulting app.js file and you should see the templates at the bottom.</li><li>Open the Network tab in devtools and click around in your app. You should not see any ajax requests loading templates.</li></ul></section></article></div></main><footer class="p-8 text-center text-sm border-t-2 border-gray-200"><span>Â©2019 Paul Salaets</span><br><span>Built with <a href="https://www.11ty.io/" rel="noopener noreferrer" class="text-blue-700 underline">Eleventy</a> and <a href="https://tailwindcss.com/" rel="noopener noreferrer" class="text-blue-700 underline">Tailwind CSS</a></span></footer></body></html>